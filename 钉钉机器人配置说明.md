# 钉钉机器人配置说明

## 🎯 问题诊断

根据错误日志显示：**钉钉机器人发送签名不匹配（errcode: 310000）**

这是因为您的钉钉机器人配置了**加签验证**，需要提供Secret密钥来生成签名。

## 🛠️ 解决方案

### 步骤1：获取钉钉机器人加签密钥

1. 登录钉钉管理后台
2. 进入群聊设置
3. 找到您的自定义机器人
4. 查看机器人的"安全设置"
5. 复制"加签"中的**Secret密钥**

### 步骤2：配置环境变量

在项目根目录的 `.env.local` 文件中，将以下内容中的密钥替换为您的实际密钥：

```bash
# 钉钉机器人AccessToken（已配置）
DINGTALK_ACCESS_TOKEN=f7cf0fd1267222a98e223611734a46cc9a705ac8ff8eb9773dcf392aa4fdc0e8

# 钉钉机器人加签密钥（请替换为您的真实密钥）
DINGTALK_SECRET=您的加签密钥
```

### 步骤3：重启开发服务器

```bash
# 停止当前服务器（Ctrl+C）
# 然后重新启动
npm run dev
```

## ✅ 验证效果

配置完成后，提交表单时应该可以看到钉钉群聊中收到格式化的客户咨询消息。

## 📋 消息格式示例

```markdown
## 🎯 新客户咨询 - SportStreamHD

📧 邮箱地址: test@example.com
✈️ 联系方式: @testuser
⚽ 感兴趣的体育项目: ⚽ 足球
💬 服务需求: 先咨询了解
📝 详细需求说明: 需要了解英超直播流接入

⏰ 咨询时间: 2024/01/XX XX:XX:XX
🚀 请及时跟进客户需求，建议在4小时内与客户取得联系！
```

## 🔧 技术细节

- 使用HMAC-SHA256算法生成签名
- 自动处理时间戳和URL编码
- 支持Vercel Serverless Functions部署
- 完善的错误处理和日志记录

## 🚨 注意事项

1. **密钥安全**：请妥善保管Secret密钥，不要提交到代码仓库
2. **Vercel部署**：部署到Vercel时，需要在Vercel控制台设置环境变量
3. **测试环境**：本地开发时使用 `.env.local`，生产环境使用Vercel环境变量

## 🎉 完成

配置完成后，您的钉钉机器人将能够成功接收客户咨询通知！